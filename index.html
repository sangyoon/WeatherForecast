<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>Virtual Fence</title>

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">

    <style type="text/css">
      html, body {margin: 0; padding: 0; height: 100%;}
      #map {margin: 0; padding: 0; height: 100%;}
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.1.0.js"></script>

    <script type="text/javascript">
      var host = '';
      var port = '';

      var socket_url = 'http://' + host + ':' + port;
      var http_url = 'http://' + host;

      var map;

      var bounds;
      var devices = [];

      function initializeMap()
      {
        var myLocation = new google.maps.LatLng( 0 , 0 );

        var opt = {
          center : myLocation,
          zoom : 10
        };

        map = new google.maps.Map( document.getElementById( 'map' ) , opt );
        bounds = new google.maps.LatLngBounds();
      }

      function getDevice( id , devices )
      {
        var device = null;

        for( var i = 0 ; i < devices.length ; ++i )
        {
          if( devices[ i ].id === id )
          {
            device = devices[ i ];

            break;
          }
        }

        return device;
      }

      function pushGPS( data )
      {
        var device = getDevice( data.id , devices );

        if( device == null )
        {
          device = newDevice( data );
          devices.push( device );
        }
        else
          updateDevice( device , data );
      }

      function createDevice( data )
      {
        var location = getLatLngFromString( data );

        var marker = new google.maps.Marker( {
          position : location,
          map : map 
        } );

        marker.set( 'device_id' , data.id );
        adjustMapBounds( location );

        return marker;
      }

      function updateDevice( device , data )
      {
        var location = getLatLngFromString( data );

        device.setPosition( location );
        adjustMapBounds( location );
      }

      function adjustMapBounds( location )
      {
        var currentBounds = map.getBounds();

        if( typeof( currentBounds ) != 'undefined' && currentBounds.contains( location ) == false )
        {
          bounds.extend( location );
          map.fitBounds( bounds );
        }
      }

      function fitAllDeivcesOnMap()
      {
        for( var i = 0 ; i < devices.length ; ++i )
        {
          var location = devices[ i ].getPosition();

          bounds.extend( location );
          map.fitBounds( bounds );
        }
      }

      function fetchLastKnownLocations()
      {
        $.get( http_url + '/devices' , function( data ) {

          for( var i = 0 ; i < data.length ; ++i )
          {
            var location = data[ i ];

            if( location.lat != 0 && location.lng != 0 )
            {
              device = createDevice( data[ i ] );
              devices.push( device );
            }
          }

          fitAllDeivcesOnMap();
        } );
      }

      function getLatLngFromString( str )
      {
        var lat = parseFloat( str.lat );
        var lng = parseFloat( str.lng );

        return new google.maps.LatLng( lat , lng );
      }

      function initialize



    </script>